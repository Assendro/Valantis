{"ast":null,"code":"import React from\"react\";import Key from\"./Key\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";class Products extends React.Component{constructor(props){super(props);this.state={error:null,isLoaded:false,items:[],page:0,displayedIds:[],limit:50,offset:0};this.inputClick=this.inputClick.bind(this);this.makeRequest=this.makeRequest.bind(this);this.takeData=this.takeData.bind(this);}makeRequest(api,offset,limit){let apiBody={action:\"get_ids\",params:{offset:offset,limit:limit}};fetch(api,{method:'POST',headers:{'Content-Type':'application/json;charset=utf-8','X-Auth':Key()},body:JSON.stringify(apiBody)}).then(res=>res.json()).then(res=>{let tempSet=new Set(res.result);let result=Array.from(tempSet);return result;},error=>{this.setState({isLoaded:true,error});}).then(res=>{let apiBodyItems={action:\"get_items\",params:{ids:res}};fetch(api,{method:'POST',headers:{'Content-Type':'application/json;charset=utf-8','X-Auth':Key()},body:JSON.stringify(apiBodyItems)}).then(res=>res.json()).then(res=>{const tempObj={};const result=res.result.filter(_ref=>{let{id}=_ref;return!tempObj[id]&&(tempObj[id]=1);});console.log(\"\\u041E\\u0442\\u043E\\u0431\\u0440\\u0430\\u0436\\u0435\\u043D\\u043E \".concat(result.length,\" \\u0442\\u043E\\u0432\\u0430\\u0440\\u043E\\u0432\"));return result;},error=>{this.setState({isLoaded:true,error});}).then(res=>this.setState({isLoaded:true,items:res}));});}takeData(){this.makeRequest(\"https://api.valantis.store:41000/\",this.state.offset,this.state.limit);}inputClick(direction){if(direction.target.className=='buttonRight'){this.setState({page:this.state.page+1,isLoaded:false});this.componentDidMount();}else if(direction.target.className=='buttonLeft'&&this.state.page>0){this.setState({page:this.state.page-1,isLoaded:false});this.componentDidMount();}}componentDidMount(){this.setState({offset:this.state.page*this.state.limit});this.takeData();}componentWillUnmount(){}render(){const{error,isLoaded,items}=this.state;if(error){console.log(error);this.componentDidMount();}else if(!isLoaded){return/*#__PURE__*/_jsxs(\"div\",{className:\"wrapper\",children:[/*#__PURE__*/_jsx(\"button\",{className:\"buttonLeft\",onClick:this.inputClick,children:\"<\"}),/*#__PURE__*/_jsx(\"div\",{className:\"container\",children:/*#__PURE__*/_jsx(\"div\",{className:\"loading\",children:\"\\u0417\\u0430\\u0433\\u0440\\u0443\\u0437\\u043A\\u0430...\"})}),/*#__PURE__*/_jsx(\"button\",{className:\"buttonRight\",onClick:this.inputClick,children:\">\"})]});}else{return/*#__PURE__*/_jsxs(\"div\",{className:\"wrapper\",children:[/*#__PURE__*/_jsx(\"button\",{className:\"buttonLeft\",onClick:this.inputClick,children:\"<\"}),/*#__PURE__*/_jsx(\"div\",{className:\"container\",children:items.map(item=>/*#__PURE__*/_jsxs(\"div\",{className:\"card\",children:[/*#__PURE__*/_jsx(\"h2\",{className:\"cardHeader\",children:item.product}),/*#__PURE__*/_jsxs(\"p\",{className:\"brand\",children:[\"\\u041F\\u0440\\u043E\\u0438\\u0437\\u0432\\u043E\\u0434\\u0438\\u0442\\u0435\\u043B\\u044C: \",item.brand?item.brand:\"Не указано\"]}),/*#__PURE__*/_jsxs(\"p\",{className:\"price\",children:[\"\\u0426\\u0435\\u043D\\u0430: \",item.price]}),/*#__PURE__*/_jsxs(\"p\",{className:\"id\",children:[\"id: \",item.id]}),/*#__PURE__*/_jsx(\"p\",{children:this.state.page})]},item.id))}),/*#__PURE__*/_jsx(\"button\",{className:\"buttonRight\",onClick:this.inputClick,children:\">\"})]});}}}export default Products;","map":{"version":3,"names":["React","Key","jsx","_jsx","jsxs","_jsxs","Products","Component","constructor","props","state","error","isLoaded","items","page","displayedIds","limit","offset","inputClick","bind","makeRequest","takeData","api","apiBody","action","params","fetch","method","headers","body","JSON","stringify","then","res","json","tempSet","Set","result","Array","from","setState","apiBodyItems","ids","tempObj","filter","_ref","id","console","log","concat","length","direction","target","className","componentDidMount","componentWillUnmount","render","children","onClick","map","item","product","brand","price"],"sources":["C:/Users/kiril/Desktop/Практика/test-task-valantis/src/components/Products.jsx"],"sourcesContent":["import React from \"react\";\r\nimport Key from \"./Key\";\r\n\r\nclass Products extends React.Component {\r\n  constructor(props) {\r\n    super(props);\r\n \r\n    this.state = {\r\n      error: null,\r\n      isLoaded: false,\r\n      items: [], \r\n      page: 0,\r\n      displayedIds: [],\r\n      limit: 50,\r\n      offset: 0,\r\n    };\r\n\r\n    this.inputClick = this.inputClick.bind(this)    \r\n    this.makeRequest = this.makeRequest.bind(this)\r\n    this.takeData = this.takeData.bind(this)\r\n  }\r\n\r\n\r\n\r\n  \r\n\r\n  makeRequest(api, offset, limit) {\r\n\r\n      let apiBody = {\r\n        action: \"get_ids\",\r\n        params: {offset: offset, limit: limit}\r\n      }\r\n      fetch(api,\r\n      { method: 'POST',\r\n        headers: {\r\n          'Content-Type': 'application/json;charset=utf-8',\r\n          'X-Auth': Key()\r\n        },\r\n        body: JSON.stringify(apiBody)\r\n      })\r\n        .then(res => res.json())\r\n        .then(\r\n          (res) => {\r\n          let tempSet = new Set(res.result)\r\n          let result = Array.from(tempSet)\r\n          return result\r\n          }, \r\n          (error) => {\r\n            this.setState({\r\n              isLoaded: true,\r\n              error\r\n            });\r\n\r\n          })\r\n        .then(res => {\r\n          let apiBodyItems = {\r\n              action: \"get_items\",\r\n              params: {ids: res}\r\n          };\r\n          fetch(api,\r\n            { method: 'POST',\r\n              headers: {\r\n                'Content-Type': 'application/json;charset=utf-8',\r\n                'X-Auth': Key()\r\n              },\r\n              body: JSON.stringify(apiBodyItems)\r\n            })\r\n            .then(res => res.json())\r\n            .then(\r\n              (res) => {\r\n              const tempObj = {};\r\n              const result = res.result.filter(({id}) =>(!tempObj[id] && (tempObj[id] = 1)));\r\n              console.log(`Отображено ${result.length} товаров`);\r\n\r\n              return result;\r\n              \r\n            }, \r\n              (error) => {\r\n                this.setState({\r\n                  isLoaded: true,\r\n                  error\r\n                });\r\n            })\r\n            .then(res => this.setState({\r\n              isLoaded: true,\r\n              items: res\r\n            }))\r\n          })\r\n\r\n  }\r\n\r\n  takeData() {\r\n    this.makeRequest(\"https://api.valantis.store:41000/\", this.state.offset, this.state.limit)\r\n  }\r\n  \r\n  inputClick(direction) {\r\n    if(direction.target.className == 'buttonRight') {\r\n      \r\n      this.setState({\r\n        page: this.state.page + 1, \r\n        isLoaded: false\r\n      })\r\n      this.componentDidMount()\r\n    } else if(direction.target.className == 'buttonLeft' && this.state.page > 0) {\r\n      this.setState({\r\n        page: this.state.page - 1, \r\n        isLoaded: false        \r\n      })\r\n      this.componentDidMount()\r\n    }\r\n  }\r\n  componentDidMount() {\r\n    this.setState({\r\n      offset: this.state.page * this.state.limit,\r\n    })\r\n    this.takeData()\r\n    \r\n  }\r\n  componentWillUnmount() { \r\n    \r\n   }\r\n\r\n  render() {\r\n    \r\n    const { error, isLoaded, items} = this.state;\r\n    if (error) {\r\n      console.log(error)\r\n      this.componentDidMount()\r\n    } else if (!isLoaded) {\r\n      return (\r\n        <div className=\"wrapper\">\r\n          <button className=\"buttonLeft\" onClick={this.inputClick}>&lt;</button>\r\n            <div className=\"container\">\r\n              <div className=\"loading\">Загрузка...</div>\r\n            </div>\r\n          <button className=\"buttonRight\" onClick={this.inputClick}>&gt;</button>\r\n        </div>\r\n      );\r\n\r\n    } else {\r\n      return (\r\n        <div className=\"wrapper\">\r\n          <button className=\"buttonLeft\" onClick={this.inputClick}>&lt;</button>\r\n            <div className=\"container\">\r\n\r\n              {items.map(item => (\r\n                <div className=\"card\" key={item.id}>\r\n                  <h2 className=\"cardHeader\">{item.product}</h2>\r\n                  <p className=\"brand\">Производитель: {(item.brand) ? item.brand : \"Не указано\"}</p>\r\n                  <p className=\"price\">Цена: {item.price}</p>\r\n                  <p className=\"id\">id: {item.id}</p>\r\n                  <p>{this.state.page}</p>\r\n                </div>\r\n              ))}\r\n            </div>\r\n          <button className=\"buttonRight\" onClick={this.inputClick}>&gt;</button>\r\n        </div>\r\n      );    }\r\n  }\r\n}\r\n\r\nexport default Products"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}