{"ast":null,"code":"import React from \"react\";\nimport Key from \"./Key\";\nimport ServerError from \"./ServerError\";\nimport AuthorizationError from \"./AuthorizationError\";\nimport filterDuplicates from \"./FilterDuplicates\";\nfunction Request(action, params) {\n  const body = {\n    action: action,\n    params: params\n  };\n  const response = fetch('https://api.valantis.store:41000/', {\n    method: 'POST',\n    headers: {\n      'Content-Type': 'application/json;charset=utf-8',\n      'X-Auth': Key()\n    },\n    body: JSON.stringify(body)\n  }).then(res => {\n    //обрабатываем ответ сервера (не ошибка для then)\n    if (!res.ok) {\n      switch (res.status) {\n        case 500:\n          console.log(`Ошибка запроса ${this.body.action == \"get_ids\" ? 'id товаров' : 'данных о товарах'} . Код: ${res.status}`);\n          throw new ServerError();\n          break;\n        case 401:\n          console.log(`Ошибка запроса ${this.body.action == \"get_ids\" ? 'id товаров' : 'данных о товарах'} . Код: ${res.status}`);\n          throw new AuthorizationError();\n          break;\n        default:\n          break;\n      }\n    } else {\n      return res;\n    }\n  }, e => {\n    throw e;\n  }).then(res => {\n    //приводим строку ответа к объекту \n    return res.json();\n  }, e => {\n    throw e;\n  }).then(res => {\n    // фильтруем дубликаты \n    if (body.action == \"get_ids\") {\n      return filterDuplicates(res.result);\n    } else {\n      const tempObj = {};\n      const uniqueRes = res.result.filter(({\n        id\n      }) => !tempObj[id] && (tempObj[id] = 1));\n      return uniqueRes;\n    }\n  }, e => {\n    throw e;\n  });\n  return response;\n}\n_c = Request;\nexport default Request;\nvar _c;\n$RefreshReg$(_c, \"Request\");","map":{"version":3,"names":["React","Key","ServerError","AuthorizationError","filterDuplicates","Request","action","params","body","response","fetch","method","headers","JSON","stringify","then","res","ok","status","console","log","e","json","result","tempObj","uniqueRes","filter","id","_c","$RefreshReg$"],"sources":["C:/Users/kiril/Desktop/Практика/test-task-valantis/src/components/Request.jsx"],"sourcesContent":["import React from \"react\"\r\nimport Key from \"./Key\";\r\nimport ServerError from \"./ServerError\";\r\nimport AuthorizationError from \"./AuthorizationError\";\r\nimport filterDuplicates from \"./FilterDuplicates\";\r\n\r\nfunction Request(action, params) {\r\n\r\n\r\n  const body = {\r\n    action: action, \r\n    params: params\r\n  }\r\n  const response = fetch('https://api.valantis.store:41000/',\r\n    { method: 'POST',\r\n    headers: {\r\n      'Content-Type': 'application/json;charset=utf-8',\r\n      'X-Auth': Key()\r\n    },\r\n    body: JSON.stringify(body)\r\n    }\r\n  ).then((res) => { //обрабатываем ответ сервера (не ошибка для then)\r\n    if(!res.ok) {\r\n      switch (res.status) {\r\n        case 500:\r\n          console.log(`Ошибка запроса ${this.body.action == \"get_ids\" ? 'id товаров': 'данных о товарах'} . Код: ${res.status}`)\r\n          throw new ServerError\r\n          break;\r\n        case 401:\r\n          console.log(`Ошибка запроса ${this.body.action == \"get_ids\" ? 'id товаров': 'данных о товарах'} . Код: ${res.status}`)\r\n          throw new AuthorizationError\r\n          break;\r\n      \r\n        default:\r\n          break;\r\n      }\r\n    } else {\r\n      return res\r\n    }\r\n  }, (e) => { throw e }).then((res) => { //приводим строку ответа к объекту \r\n    return res.json() \r\n  }, (e) => { throw e; }).then((res) => { // фильтруем дубликаты \r\n    if (body.action == \"get_ids\") {\r\n      return filterDuplicates(res.result)\r\n    } else {\r\n      const tempObj = {}\r\n      const uniqueRes = res.result.filter(({id}) =>(!tempObj[id] && (tempObj[id] = 1)))\r\n      return uniqueRes\r\n    }    \r\n  }, (e) => { throw e; })\r\n\r\n\r\n  return response\r\n}\r\n\r\n\r\nexport default Request"],"mappings":"AAAA,OAAOA,KAAK,MAAM,OAAO;AACzB,OAAOC,GAAG,MAAM,OAAO;AACvB,OAAOC,WAAW,MAAM,eAAe;AACvC,OAAOC,kBAAkB,MAAM,sBAAsB;AACrD,OAAOC,gBAAgB,MAAM,oBAAoB;AAEjD,SAASC,OAAOA,CAACC,MAAM,EAAEC,MAAM,EAAE;EAG/B,MAAMC,IAAI,GAAG;IACXF,MAAM,EAAEA,MAAM;IACdC,MAAM,EAAEA;EACV,CAAC;EACD,MAAME,QAAQ,GAAGC,KAAK,CAAC,mCAAmC,EACxD;IAAEC,MAAM,EAAE,MAAM;IAChBC,OAAO,EAAE;MACP,cAAc,EAAE,gCAAgC;MAChD,QAAQ,EAAEX,GAAG,CAAC;IAChB,CAAC;IACDO,IAAI,EAAEK,IAAI,CAACC,SAAS,CAACN,IAAI;EACzB,CACF,CAAC,CAACO,IAAI,CAAEC,GAAG,IAAK;IAAE;IAChB,IAAG,CAACA,GAAG,CAACC,EAAE,EAAE;MACV,QAAQD,GAAG,CAACE,MAAM;QAChB,KAAK,GAAG;UACNC,OAAO,CAACC,GAAG,CAAE,kBAAiB,IAAI,CAACZ,IAAI,CAACF,MAAM,IAAI,SAAS,GAAG,YAAY,GAAE,kBAAmB,WAAUU,GAAG,CAACE,MAAO,EAAC,CAAC;UACtH,MAAM,IAAIhB,WAAW,CAAD,CAAC;UACrB;QACF,KAAK,GAAG;UACNiB,OAAO,CAACC,GAAG,CAAE,kBAAiB,IAAI,CAACZ,IAAI,CAACF,MAAM,IAAI,SAAS,GAAG,YAAY,GAAE,kBAAmB,WAAUU,GAAG,CAACE,MAAO,EAAC,CAAC;UACtH,MAAM,IAAIf,kBAAkB,CAAD,CAAC;UAC5B;QAEF;UACE;MACJ;IACF,CAAC,MAAM;MACL,OAAOa,GAAG;IACZ;EACF,CAAC,EAAGK,CAAC,IAAK;IAAE,MAAMA,CAAC;EAAC,CAAC,CAAC,CAACN,IAAI,CAAEC,GAAG,IAAK;IAAE;IACrC,OAAOA,GAAG,CAACM,IAAI,CAAC,CAAC;EACnB,CAAC,EAAGD,CAAC,IAAK;IAAE,MAAMA,CAAC;EAAE,CAAC,CAAC,CAACN,IAAI,CAAEC,GAAG,IAAK;IAAE;IACtC,IAAIR,IAAI,CAACF,MAAM,IAAI,SAAS,EAAE;MAC5B,OAAOF,gBAAgB,CAACY,GAAG,CAACO,MAAM,CAAC;IACrC,CAAC,MAAM;MACL,MAAMC,OAAO,GAAG,CAAC,CAAC;MAClB,MAAMC,SAAS,GAAGT,GAAG,CAACO,MAAM,CAACG,MAAM,CAAC,CAAC;QAACC;MAAE,CAAC,KAAK,CAACH,OAAO,CAACG,EAAE,CAAC,KAAKH,OAAO,CAACG,EAAE,CAAC,GAAG,CAAC,CAAE,CAAC;MACjF,OAAOF,SAAS;IAClB;EACF,CAAC,EAAGJ,CAAC,IAAK;IAAE,MAAMA,CAAC;EAAE,CAAC,CAAC;EAGvB,OAAOZ,QAAQ;AACjB;AAACmB,EAAA,GA/CQvB,OAAO;AAkDhB,eAAeA,OAAO;AAAA,IAAAuB,EAAA;AAAAC,YAAA,CAAAD,EAAA"},"metadata":{},"sourceType":"module","externalDependencies":[]}